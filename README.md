# API Каталога Товаров для Интерьера

Этот проект представляет собой RESTful API для каталога товаров для интерьера, разработанный с использованием FastAPI и PostgreSQL. Приложение упаковано в Docker-контейнеры для легкого развертывания и масштабирования.

## Технологический стек

- **Бэкенд**: Python 3.9
- **Фреймворк**: FastAPI
- **База данных**: PostgreSQL 14
- **Взаимодействие с БД**: `asyncpg`
- **Контейнеризация**: Docker, Docker Compose

## Требования

Для запуска проекта на локальной машине необходимо установить:
- [Docker](https://www.docker.com/products/docker-desktop)
- [Docker Compose](https://docs.docker.com/compose/install/) (обычно поставляется вместе с Docker Desktop)

## Запуск проекта

1. **Клонируйте репозиторий** (если проект находится в Git) или убедитесь, что все файлы проекта находятся в одной директории.

2. **Создайте и запустите контейнеры**. Откройте терминал в корневой директории проекта и выполните команду:
   ```bash
   docker-compose up --build -d
   ```
   - `--build`: принудительно пересобирает образ приложения, что необходимо после внесения изменений в код (например, в `main.py`).
   - `-d`: запускает контейнеры в фоновом режиме (detached mode).

3. **Проверка статуса**. Убедитесь, что оба контейнера (`app` и `db`) успешно запустились:
   ```bash
   docker-compose ps
   ```
   Вы должны увидеть, что у обоих сервисов статус `Up` или `running`. У сервиса `db` статус может быть `running (healthy)`, что означает, что база данных готова к работе.

Приложение будет доступно по адресу `http://localhost:8000`.

## Автоматическая документация API

FastAPI автоматически генерирует интерактивную документацию. Чтобы ее посмотреть, перейдите по одному из следующих URL в вашем браузере:
- **Swagger UI**: `http://localhost:8000/docs`
- **ReDoc**: `http://localhost:8000/redoc`

## Заполнение базы данных тестовыми данными

После первого запуска база данных будет пустой. Чтобы наполнить ее тестовыми данными, в проекте предусмотрен SQL-скрипт `data.sql`.

Выполните следующую команду в терминале, чтобы скопировать скрипт в контейнер с БД и выполнить его:
```powershell
# Для Windows PowerShell
docker cp data.sql vision_ai-db-1:/data.sql; docker exec vision_ai-db-1 psql -U postgres -d interior_db -f /data.sql

# Для Bash (Linux/macOS)
docker cp data.sql vision_ai-db-1:/data.sql && docker exec vision_ai-db-1 psql -U postgres -d interior_db -f /data.sql
```
*Примечание: `vision_ai-db-1` - это имя контейнера по умолчанию. Оно может отличаться. Проверьте актуальное имя командой `docker ps`.*


## Описание API Эндпоинтов

### 1. Получение списка дверей

- **Endpoint**: `GET /doors/`
- **Описание**: Возвращает список дверей с возможностью сложной фильтрации.
- **Query-параметры (все опциональные)**:
    - `room_type: str` - Тип комнаты (например, "Гостиная"). Поиск по частичному совпадению без учета регистра.
    - `min_price: float` - Минимальная цена.
    - `max_price: float` - Максимальная цена.
    - `style: str` - Название стиля (например, "Классический"). Поиск по частичному совпадению.
    - `material: str` - Название материала (например, "дуб"). Поиск по частичному совпадению.
    - `brand: str` - Название бренда. Поиск по частичному совпадению.
- **Пример запроса `curl`**:
  ```bash
  # Найти все двери в классическом стиле дороже 30000
  curl "http://localhost:8000/doors/?style=Классический&min_price=30000"
  ```
- **Пример успешного ответа (200 OK)**:
  ```json
  [
    {
      "product_id": 1,
      "name": "Дверь \"Версаль\"",
      "price": 35000.0,
      "description": "Элегантная дверь из массива дуба в классическом стиле. Идеально для гостиной.",
      "category": "Межкомнатные двери",
      "style": "Классический",
      "brand": null,
      "material": "Массив дуба",
      "room_type": "Гостиная"
    }
  ]
  ```

### 2. Сохранение пользовательского фильтра

- **Endpoint**: `POST /filters/`
- **Описание**: Сохраняет набор фильтров для конкретного пользователя.
- **Query-параметры**:
    - `user_id: int` (обязательный) - ID пользователя, для которого сохраняется фильтр.
- **Тело запроса (Request Body)**:
  - `name: str` - Название для сохраняемого фильтра.
  - `filters: dict` - JSON-объект с параметрами фильтрации.
- **Пример запроса `curl`**:
  ```bash
  curl -X POST "http://localhost:8000/filters/?user_id=1" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Мои двери для дачи",
    "filters": {
      "style": "Классический",
      "max_price": 40000
    }
  }'
  ```
- **Пример успешного ответа (201 Created)**:
  ```json
  {
    "status": "saved",
    "filter_name": "Мои двери для дачи"
  }
  ```
- **Пример ответа при ошибке (401 Unauthorized)**:
  ```json
  {
    "detail": "User ID is required to save filters"
  }
  ```

## Структура проекта

- `main.py`: Основной файл приложения FastAPI со всей логикой API.
- `docker-compose.yaml`: Файл конфигурации для оркестрации Docker-контейнеров.
- `Dockerfile.dockerfile`: Инструкции по сборке Docker-образа для приложения FastAPI.
- `requirements.txt`: Список Python-зависимостей.
- `schema.sql`: SQL-схема для создания структуры базы данных при первом запуске.
- `README.md`: Эта документация. 